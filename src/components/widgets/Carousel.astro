---
import type { ImageMetadata } from "astro";

interface ImageType {
  src: ImageMetadata;
  alt: string;
}

interface Props {
  images: ImageType[];
  widthType?: "normal" | "default";
  displayMode?: "contain" | "cover";
  removeBottomMargin?: boolean;
}

const { images = [], widthType = "default", displayMode = "contain", removeBottomMargin = false }: Props =
  Astro.props;

const getHeightClass = (type: Props["widthType"]): string => {
  if (type === "normal") {
    return "h-[calc(100vh-64px)] md:h-[38rem]";
  }

  return "h-[calc(100vh-120px)] md:h-[36rem]";
};

const getContainerClass = (type: Props["widthType"]): string => {
  if (type === "normal") {
    return "max-w-[1280px] w-full";
  }

  return "max-w-screen-2xl w-full px-4 sm:px-6 lg:px-8";
};

const getMarginClass = (removeMargin: boolean): string => {
  if (removeMargin) {
    return "";
  }
  return "mb-6 md:mb-14";
};

const heightClass = getHeightClass(widthType);
const containerClass = getContainerClass(widthType);
const marginClass = getMarginClass(removeBottomMargin);
const eagerLoading = widthType === "default" ? "eager" : "lazy";
---

{images.length ? (
  <section
    class={`mx-auto ${containerClass} ${marginClass}`}
    data-carousel-root
    aria-roledescription="carousel"
  >
    <div class="relative">
      <div class={`overflow-hidden rounded-lg ${heightClass}`} data-carousel-viewport style="touch-action: pan-y pinch-zoom;">
        <div class="flex -ml-4 h-full" style="touch-action: pan-y pinch-zoom;">
          {images.map((image, index) => (
            <div class="min-w-0 shrink-0 grow-0 basis-full pl-4" data-carousel-slide role="group" aria-label={`Slide ${index + 1} of ${images.length}`} style="will-change: transform;">
              <button
                type="button"
                class="block h-full w-full overflow-hidden"
                data-carousel-open-lightbox
                data-src={image.src.src}
                data-alt={image.alt || `Carousel image ${index + 1}`}
                aria-label={`${image.alt || `Slide ${index + 1}`} - Άνοιγμα σε μεγάλη προβολή`}
              >
                {displayMode === "contain" ? (
                  <div
                    class="relative h-full w-full overflow-hidden rounded-lg bg-slate-200 dark:bg-slate-800 animate-pulse"
                    data-carousel-skeleton
                    style="will-change: transform;"
                  >
                    <img
                      src={image.src.src}
                      alt=""
                      aria-hidden="true"
                      loading={eagerLoading}
                      decoding="async"
                      style="will-change: opacity; transform: translateZ(0);"
                      class="absolute inset-0 h-full w-full scale-110 object-cover blur-xl md:blur-3xl opacity-30 md:opacity-40 transition-opacity duration-500 pointer-events-none"
                    />
                    <img
                      src={image.src.src}
                      alt={image.alt || `Carousel image ${index + 1}`}
                      width={image.src?.width}
                      height={image.src?.height}
                      loading={eagerLoading}
                      decoding="async"
                      fetchpriority={index === 0 ? "high" : undefined}
                      style="will-change: opacity; transform: translateZ(0);"
                      class="relative h-full w-full object-contain opacity-0 transition-opacity duration-500 pointer-events-none"
                      data-carousel-image
                    />
                  </div>
                ) : (
                  <div
                    class="relative h-full w-full overflow-hidden rounded-lg bg-slate-200 dark:bg-slate-800 animate-pulse"
                    data-carousel-skeleton
                    style="will-change: transform;"
                  >
                    <img
                      src={image.src.src}
                      alt={image.alt || `Carousel image ${index + 1}`}
                      width={image.src?.width}
                      height={image.src?.height}
                      loading={eagerLoading}
                      decoding="async"
                      fetchpriority={index === 0 ? "high" : undefined}
                      style="will-change: opacity; transform: translateZ(0);"
                      class="h-full w-full object-cover opacity-0 transition-opacity duration-500 pointer-events-none"
                      data-carousel-image
                    />
                  </div>
                )}
              </button>
            </div>
          ))}
        </div>
      </div>

      <div class="pointer-events-none absolute inset-0 flex items-center justify-between px-4">
        <button
          type="button"
          class="pointer-events-auto inline-flex h-10 w-10 items-center justify-center rounded-full bg-white/90 text-gray-900 shadow ring-1 ring-black/5 transition hover:bg-white"
          aria-label="Previous slide"
          data-carousel-prev
        >
          <svg viewBox="0 0 20 20" fill="none" aria-hidden="true" class="h-5 w-5">
            <path
              d="M12.5 5l-5 5 5 5"
              stroke="currentColor"
              stroke-width="1.5"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
        </button>
        <button
          type="button"
          class="pointer-events-auto inline-flex h-10 w-10 items-center justify-center rounded-full bg-white/90 text-gray-900 shadow ring-1 ring-black/5 transition hover:bg-white"
          aria-label="Next slide"
          data-carousel-next
        >
          <svg viewBox="0 0 20 20" fill="none" aria-hidden="true" class="h-5 w-5">
            <path
              d="M7.5 5l5 5-5 5"
              stroke="currentColor"
              stroke-width="1.5"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
        </button>
      </div>
    </div>

    <div
      class="fixed inset-0 z-50 hidden flex items-center justify-center bg-black/80 p-4"
      data-carousel-lightbox
      aria-modal="true"
      role="dialog"
      aria-label="Προβολή εικόνας gallery"
      tabindex="-1"
    >
      <div class="relative w-full max-w-[90vw]">
        <button
          type="button"
          class="absolute right-2 top-2 inline-flex h-10 w-10 items-center justify-center rounded-full bg-white/90 text-gray-900 transition hover:bg-white"
          aria-label="Close image preview"
          data-carousel-lightbox-close
        >
          <svg viewBox="0 0 20 20" fill="none" aria-hidden="true" class="h-5 w-5">
            <path
              d="M6 6l8 8M6 14L14 6"
              stroke="currentColor"
              stroke-width="1.5"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
        </button>
        <img
          data-carousel-lightbox-img
          src={images[0]?.src.src}
          alt={images[0]?.alt || "Carousel image"}
          class="h-auto w-full max-h-[90vh] rounded-md object-contain shadow-2xl"
          loading="eager"
        />
      </div>
    </div>
  </section>
) : null}
